<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>유명커튼블라인드</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
            emailjs.init("YOUR_PUBLIC_KEY"); // EmailJS 공개 키를 여기에 입력하세요
        })();
    </script>
    <style>
        .main-visual {
            position: relative;
            width: 100%;
            height: 760px; /* 380px의 두 배로 설정 */
            overflow: hidden;
            margin-bottom: 30px;
        }

        .main-visual img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.8);
        }

        .features {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            padding: 40px 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .feature-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .feature-item img {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }

        .feature-text {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
        }

        .feature-text h3 {
            margin: 0 0 5px 0;
            font-size: 1.2em;
        }

        .feature-text p {
            margin: 0;
            font-size: 0.9em;
            opacity: 0.9;
        }
    </style>
</head>
<body>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script>
        // Firebase 설정 및 초기화
        const firebaseConfig = {
            apiKey: "AIzaSyCM8IflmHHgMaFseEoPPsECsLxsSAjj1Vw",
            authDomain: "curtainweb.firebaseapp.com",
            projectId: "curtainweb",
            storageBucket: "curtainweb.firebasestorage.app",
            messagingSenderId: "1004027071653",
            appId: "1:1004027071653:web:f29be419700c6302b6114c"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        
        console.log('✅ Firebase 초기화 완료');
    </script>

    <header class="header">
        <div class="container">
            <h1><a href="index.html" class="logo-text">유명커튼블라인드</a></h1>
            <nav>
                <ul class="nav-menu">
                    <li><a href="pages/curtains.html">커튼</a></li>
                    <li><a href="pages/blinds.html">블라인드</a></li>
                    <li><a href="pages/portfolio.html">시공사례</a></li>
                    <li><a href="pages/contact.html">상담신청</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="main-visual">
            <div class="main-visual" id="mainVisual">
                <img id="mainImage" alt="메인 비주얼" style="display: none;">
                <div class="main-text">
                    <h2 id="mainTitle">프리미엄 커튼으로 특별한 공간을 만듭니다</h2>
                    <p id="mainDescription">고객님의 간에 어울리는 맞형 디자인을 제안해드립니다</p>
                </div>
            </div>
        </section>

        <section id="products" class="products">
            <div class="container">
                <h3 class="section-title">인기 제품</h3>
                <div class="product-grid" id="productGrid">
                    <!-- Firebase에서 동적으로 로드 -->
                    <div class="product-card">
                        <p style="text-align: center; color: #888;">제품 로딩 중...</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="contact" class="contact">
            <div class="container">
                <h3>무료 방문견적 상담신청</h3>
                <form id="contactForm" class="contact-form">
                    <input type="text" name="name" placeholder="이름" required>
                    <input type="tel" name="phone" placeholder="연락처" required>
                    <input type="text" name="address" placeholder="주소" required>
                    <textarea name="message" placeholder="문의사항을 입력해주세요" required></textarea>
                    <button type="submit">신청하기</button>
                </form>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="company-info">
                <p>상호: 유명커튼블라인드 | 대표:김도범</p>
                <p>대표번호: 02-588-2389</p>
                <p>주소:서울시 서초구 방배천로 16길 18.</p>
                <div class="admin-access">
                    <button onclick="location.href='admin/login.html'" class="admin-btn">
                        관리자
                    </button>
                </div>
            </div>
        </div>
    </footer>

    <div id="adminModal" 
         style="display: none; 
                position: fixed; 
                top: 50%; 
                left: 50%; 
                transform: translate(-50%, -50%); 
                background: white; 
                padding: 20px; 
                border-radius: 8px; 
                box-shadow: 0 0 10px rgba(0,0,0,0.1); 
                z-index: 1000;">
        <h3 style="margin-bottom: 15px;">관리자 로그인</h3>
        <form id="adminLoginForm" style="display: flex; flex-direction: column; gap: 10px;">
            <input type="text" id="adminId" placeholder="아이디" required 
                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <input type="password" id="adminPw" placeholder="비밀번호" required 
                   style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            <button type="submit" 
                    style="padding: 8px; background: #333; color: white; border: none; border-radius: 4px; cursor: pointer;">
                로그인
            </button>
            <button type="button" onclick="closeAdminModal()" 
                    style="padding: 8px; background: #ddd; border: none; border-radius: 4px; cursor: pointer;">
                취소
            </button>
        </form>
    </div>

    <div id="modalOverlay" 
         style="display: none; 
                position: fixed; 
                top: 0; 
                left: 0; 
                width: 100%; 
                height: 100%; 
                background: rgba(0,0,0,0.5); 
                z-index: 999;">
    </div>

    <script src="js/main.js"></script>
    <script>
        let logoClickCount = 0;
        document.getElementById('adminAccess').addEventListener('click', function() {
            logoClickCount++;
            if(logoClickCount === 5) {
                window.location.href = '/admin/login.html';
                logoClickCount = 0;
            }
        });

        function showAdminLogin() {
            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('modalOverlay').style.display = 'block';
        }

        function closeAdminModal() {
            document.getElementById('adminModal').style.display = 'none';
            document.getElementById('modalOverlay').style.display = 'none';
        }

        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const id = document.getElementById('adminId').value;
            const pw = document.getElementById('adminPw').value;

            if(id === 'admin' && pw === '1234') {
                alert('관리자 로그인 성공!');
                window.location.href = 'admin/dashboard.html';
            } else {
                alert('아이디 또는 비밀번호가 잘못되었습니다.');
            }
        });

        document.getElementById('modalOverlay').addEventListener('click', closeAdminModal);

        // Firebase에서 메인 이미지 로드
        async function loadMainImage() {
            console.log('=== 메인 이미지 로딩 시작 ===');
            const img = document.getElementById('mainImage');
            
            try {
                const snapshot = await db.collection('main-images').get();
                console.log('메인 이미지 스냅샷:', snapshot.size, '개');
                
                if (!snapshot.empty) {
                    const image = snapshot.docs[0].data();
                    console.log('메인 이미지 데이터:', image);
                    
                    if (img && image.imageUrl) {
                        console.log('✅ Firebase 이미지로 변경:', image.imageUrl);
                        
                        // 이미지 로드 완료 후 표시
                        img.onload = function() {
                            img.style.display = 'block';
                            console.log('✅ 이미지 표시 완료');
                        };
                        
                        img.src = image.imageUrl;
                        img.alt = image.title || '메인 이미지';
                    } else {
                        console.log('⚠️ imageUrl 없음');
                    }
                } else {
                    console.log('⚠️ Firebase에 메인 이미지 없음 - 메인 이미지 관리에서 등록하세요');
                }
            } catch (error) {
                console.error('❌ 메인 이미지 로드 실패:', error.message);
            }
        }

        // Firebase에서 텍스트 로드
        async function loadTexts() {
            try {
                const doc = await db.collection('site-settings').doc('texts').get();
                if (doc.exists) {
                    const data = doc.data();
                    if (data.mainTitle) {
                        document.getElementById('mainTitle').textContent = data.mainTitle;
                    }
                    if (data.mainDescription) {
                        document.getElementById('mainDescription').textContent = data.mainDescription;
                    }
                }
            } catch (error) {
                console.error('텍스트 로드 실패:', error);
            }
        }

        // Firebase에서 제품 로드
        async function loadProducts() {
            try {
                const snapshot = await db.collection('products').limit(6).get();
                const productGrid = document.getElementById('productGrid');
                
                if (snapshot.empty) {
                    productGrid.innerHTML = '<div class="product-card"><p style="text-align: center; color: #888;">등록된 제품이 없습니다.</p></div>';
                    return;
                }
                
                productGrid.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const product = doc.data();
                    const card = document.createElement('div');
                    card.className = 'product-card';
                    card.innerHTML = `
                        <img src="${product.imageUrl || 'https://images.unsplash.com/photo-1505692952047-1a78307da8f2'}" alt="${product.name}">
                        <h4>${product.name}</h4>
                        <p>${product.description || (product.category === 'curtain' ? '커튼' : '블라인드')}</p>
                        <button class="product-btn" onclick="location.href='pages/${product.category === 'curtain' ? 'curtains' : 'blinds'}.html'">상세보기</button>
                    `;
                    productGrid.appendChild(card);
                });
            } catch (error) {
                console.error('제품 로드 실패:', error);
                document.getElementById('productGrid').innerHTML = '<div class="product-card"><p style="text-align: center; color: #888;">제품을 불러올 수 없습니다.</p></div>';
            }
        }
        
        // 페이지 로드 시 모든 데이터 로드
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM 로드 완료, 데이터 로딩 시작...');
            setTimeout(() => {
                loadMainImage();
                loadTexts();
                loadProducts();
            }, 500);
        });

        document.getElementById('contactForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            
            // 버튼 비활성화
            const submitBtn = form.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.textContent = '전송 중...';
            
            try {
                // Firebase에 문의사항 저장
                await db.collection('inquiries').add({
                    name: formData.get('name'),
                    phone: formData.get('phone'),
                    address: formData.get('address'),
                    message: formData.get('message'),
                    read: false,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert('문의가 접수되었습니다. 빠른 시일 내에 연락드리겠습니다.');
                form.reset();
            } catch (error) {
                console.error('문의 접수 실패:', error);
                alert('문의 접수에 실패했습니다. 다시 시도해주세요.');
            } finally {
                // 버튼 활성화
                submitBtn.disabled = false;
                submitBtn.textContent = '신청하기';
            }
        });
    </script>

    <div class="floating-call">
        <a href="tel:02-588-2389" class="call-button">
            <i class="fas fa-phone"></i>
            <span class="call-text">02-588-2389</span>
        </a>
    </div>
</body>
</html>